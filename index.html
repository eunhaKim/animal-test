<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¸ê³µì§€ëŠ¥ ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="header">
    <h1>ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</h1>
    <h3>ì–¼êµ´ë¡œ ë³´ëŠ” ì¸ê³µì§€ëŠ¥ ë™ë¬¼ìƒ í…ŒìŠ¤íŠ¸</h3>
  </div>

  <div class="container">
    <!-- <button type="button" onclick="init()">Start</button> -->
    <div id="upload-area" class="area">
      <span class="guide-image">ğŸ“·</span>
      <br />
      <span>ì‚¬ì§„ì„ ì˜¬ë ¤ë†“ê±°ë‚˜ ëˆŒëŸ¬ì„œ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”!</span>
      <input id="upload-input" style="display: none;" type="file" accept="image/*" onchange="readFile(this.files[0]);"/>
    </div>
    
    <div id="loading-area" class="area" style="display: none;">
      <span class="guide-image">ğŸƒâ€â™‚ï¸â“</span>
      <br />
      <span>ì¸ê³µì§€ëŠ¥ ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span>
    </div>
    
    <div id="result-area" class="area" style="display: none;">
      <img id="upload-image" src="#" alt="your image" style="width:100%; max-width:400px"/>
      <div id="label-container"></div>
    </div>
    
    <div id="retry-area" class="area" style="display: none;">
      <span>ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ëˆŒëŸ¬ì£¼ì„¸ìš”!</span>
    </div>
  </div>
  <div id="disqus_thread"></div>

  
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
  <script type="text/javascript">
      // More API functions here:
      // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
  
      // the link to your model provided by Teachable Machine export panel
      const URL = "https://teachablemachine.withgoogle.com/models/EhnT_46lq/";
  
      let model, labelContainer, maxPredictions;
      let isModelReady = false;
      let input = document.getElementById("upload-input");
      let image = document.getElementById("upload-image");
      let uploadArea = document.getElementById("upload-area");
      let loadingArea = document.getElementById("loading-area");
      let resultArea = document.getElementById("result-area");
      let retryArea = document.getElementById("retry-area");
      const reader = new FileReader();

      // ë¡œë”©ì¤‘
      async function readFile(file){
        uploadArea.style.display = "none";
        if(isModelReady === false){
          loadingArea.style.display = "block";
          await init();
        }
        reader.readAsDataURL(file);
      }

      //ê²°ê³¼í˜ì´ì§€
      reader.onload = async function(event){
        await image.setAttribute('src',event.target.result);
        await predict();
        loadingArea.style.display = "none";
        resultArea.style.display = "block";
        retryArea.style.display = "block";
      }

      uploadArea.onclick = function(){
        input.click();
      }

      uploadArea.ondragover = function(){
        event.preventDefault();
      }

      uploadArea.ondrop = function(event){
        event.preventDefault();
        const file = event.dataTransfer.files[0];
        readFile(file);
      }

      retryArea.onclick = function(){
        retryArea.style.display = "none";
        resultArea.style.display ="none";
        uploadArea.style.display = "block";
        input.value = "";
      }
  
      // Load the image model and setup the webcam
      async function init() {
          const modelURL = URL + "model.json";
          const metadataURL = URL + "metadata.json";
  
          // load the model and metadata
          // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
          // or files from your local hard drive
          // Note: the pose library adds "tmImage" object to your window (window.tmImage)
          model = await tmImage.load(modelURL, metadataURL);
          maxPredictions = model.getTotalClasses();
  
          
          labelContainer = document.getElementById("label-container");
          for (let i = 0; i < maxPredictions+1; i++) { // and class labels
              labelContainer.appendChild(document.createElement("div"));
          }
      }
  
      
  
      // run the webcam image through the image model
      async function predict() {
          const prediction = await model.predict(image);

          prediction.sort((x,y)=>y.probability - x.probability);

          switch (prediction[0].className){
            case "ê°•ì•„ì§€":
              labelContainer.childNodes[0].innerHTML = "<h3>ë‹¹ì‹ ì€ ê°•ì•„ì§€ìƒì´êµ°ìš”.</h3>";
              break;
            case "ê³ ì–‘ì´":
              labelContainer.childNodes[0].innerHTML = "<h3>ë‹¹ì‹ ì€ ê³ ì–‘ì´ìƒì´êµ°ìš”.</h3>";
              break;
            case "ë¼ì§€":
              labelContainer.childNodes[0].innerHTML = "<h3>ë‹¹ì‹ ì€ ë¼ì§€ìƒì´êµ°ìš”.</h3>";
              break;
            case "ë§":
              labelContainer.childNodes[0].innerHTML = "<h3>ë‹¹ì‹ ì€ ë§ìƒì´êµ°ìš”.</h3>";
              break;
            case "ì¥":
              labelContainer.childNodes[0].innerHTML = "<h3>ë‹¹ì‹ ì€ ì¥ìƒì´êµ°ìš”.</h3>";
              break;
            default:
              labelContainer.childNodes[0].innerHTML = "<h3>ì˜¤ë¥˜ ë°œìƒ</h3>";
              break;
          }

          for (let i = 0; i < maxPredictions; i++) {
              const classPrediction =
                  prediction[i].className + ": " + Math.round(prediction[i].probability*100)+"%";
              labelContainer.childNodes[i+1].innerHTML = classPrediction;
          }
          isModelReady = true;
      }
  </script>

  <script>
    /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
    /*
    var disqus_config = function () {
    this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
    this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://dongmulsangteseuteu-15.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</body>
</html>